1. 绪论
   * 背景
     * 分布式存储
   * 目的和意义
   * 国内外现状
     * Bigtable ， Cassandra ， Dynamo数据库的特点分析，比较
   * 本文主要研究内容和结构安排

2. 系统需求与分析

   * 系统功能需求分析
     * 一致性需求分析
     * 事务支持需求分析
     * 持久化需求分析
     * 自动伸缩，扩容，负载均衡分析


   * 系统性能需求分析
   * 相关技术介绍
     * 一致性协议
     * 哈希算法
     * 观察者设计模式

3. 基于Raft 协议的 K/V存储设计与实现
   * 整体架构设计
     * 整体架构
     * 一致性算法选择
     * 持久化方案选择
     * 系统各个模块间通讯方式设计
   * 设计与实现
     * raft 一致性算法的实现
     * 持久化 实现
     * 观察者模式实现
     * 事务支持
     * 系统弹性伸缩

4. 测试

   * 系统模块单元测试
   * 系统性能测试
   * 测试结果分析


## 技术储备

### LaTeX学习

https://zhuanlan.zhihu.com/p/24101761

http://www.hanlindong.com/2017/latex-on-mac/

http://blog.csdn.net/simple_the_best/article/details/50608124

http://blog.csdn.net/simple_the_best/article/details/51244631

LATEXLATEX与Word的相互转换:Pandoc

模板： http://www.latexstudio.net/archives/category/latex-templates/thesis-template

### TiDB

[官方文档](https://pingcap.com/docs-cn/overview/#tidb-%e7%ae%80%e4%bb%8b)

http://chuansong.me/n/720316151966

[2018校招ppt](http://h5.ppj.io/PneaURFh/index.html?from=timeline&isappinstalled=0)

- 想深入理解业界最前沿的分布式数据库 Spanner 的设计和思考，如何从 0 到 1 落地实现
- 如何设计和实现世界前沿的分布式 SQL 优化器，让一个复杂的 SQL 查询变的无比轻快智能
- 如何在成千上万台集群规模的情况下，实现无阻塞的表结构变更操作，而不影响任何在线的业务
- 如何实现一个高效的分布式事务管理器，让 ACID 事务在大规模并发的分布式存场景下依然可以高效可靠
- 如何基于一致性的 Raft 协议实现快速稳定的数据复制和自动故障恢复，确保数据安全
- 如何在一个 PR 提交之后，快速验证千万级别的 tests 是否全部通过，性能有没有显著提升

### etcd

* [Etcd 架构与实现解析](http://jolestar.com/etcd-architecture/)
* [etcd：从应用场景到实现原理的全方位解读](http://www.infoq.com/cn/articles/etcd-interpretation-application-scenario-implement-principle)
* [基于Go的K/V数据库BoltDB简介](http://www.opscoder.info/boltdb_intro.html)  ,  [http://boltdb.cn/](http://boltdb.cn/)







### paper read

* Dynamo: amazon's highly available key-value store
* HyperDex: a distributed, searchable key-value store
* Bigtable: A Distributed Storage System for Structured Data
* Cassandra - A Decentralized Structured Storage System
* Spanner: Google’s Globally-Distributed Database  ， [厦门大学计算机系中文翻译](http://dblab.xmu.edu.cn/post/google-spanner/)
  * https://segmentfault.com/a/1190000009707788  CAP
* ​











摘要

​	随着大数据和深度学习的飞速发展，需要存储和处理的数据量日益增多，传统的的单机数据库的性能和容量已经难以满足现代的数据规模和效率要求。将传统的单机数据库转变为分布式数据库成为一种有效的解决方法。面对超大规模，海量数据，高可用性，高扩展性的需求下，构建高性能，高可用性的大规模分布式存储系统受到了工业界和学术界的广泛关注。

​	本文主要研究一种基于Raft一致性算法，来实现分布式的 key-value 存储。主要工作包括以下几个部分：

​	第一部分是分析已有的SQL和NoSQL数据库的特点和不足，设计并实现分布式，高性能的数据库。通过分析多种一致性算法的原理，比较各种算法的特点，选取Raft算法作为分布式数据库的中数据一致性的算法。

​	第二部分，分别从 Leader 选举， log 复制 ，数据读写等方面解析Raft 算法的实现细节，并优化Raft协议的读性能。 单机K/V 存储，数据持久化等等，mvcc多版本控制（是否要做）？

​	第三部分，设计和实现 raft协议， k/v存储，数据持久化，gRPC等的分布式数据库，并测试。最后，根据测试结果进一步优化设计和实现，研究进一步提高性能和可靠性的设计和方法。

​	本文所研究的 分布式K/V存储数据库是 目前大规模存储的主要技术之一，论文的研究成果可以在一定程度上提高分布式数据库的性能和发展，是分布式数据库领域的一次有益的探索。

**关键词**：分布式数据库， Raft , key-value 存储 

传统数据库有关系型数据库和非关系型数据库。关系型数据库有：MySQL，PostgreSQL ， Oracle 等；非关系型数据库有：BigTable、HBase、Cassandra、CouchDB、MongoDB和Redis等。NewSQL：Google的Spanner，Amazon的Aurora等等

# 绪论

## 研究背景、目的和意义

随着云时代的到来，大数据和深度学习的急速发展，数据的类别和规模呈现空前的增长速度。传统的集中式数据库，数据存储在单点的存储服务中，单点的存储服务面对大规模的数据时成为系统的瓶颈，同时单点存储服务的可靠性和可用性也无法满足现代应用的需求。使得传统的单机存储系统难以满足如今海量数据增长的存储需求。

如何管理，存储 好如此庞大的数据也成了学术界和工业界研究的热点问题，关键挑战是设计一个高性能，高可用，高扩展的存储系统。分布式系统早在上世纪七八十年代就已经出现，只是在互联网的快速发展和大数据时代的到来，分布式系统才益发重要。同时，随着大数据，深度学习的到来，分布式处理的方式越来越受到业界的青睐。它通过将大量、便宜、不 可靠的存储设备联网在一起来提供具有高可靠性和高可用性的存储服务，很好地解决 传统 存储区域网络中 难以根除的容量和性能均衡分布的难题。这其中尤为瞩目的是分布式的 NoSQL 数据库，诸如 Google 的 BigTable[1]和 Spanner[2]，亚马逊的 Dynamo[3]，Facebook 的 Cassandra，HBase，ProjectVoldemort 等等。这些分布式非关系型数据库充分结合分 布式系统抗单点故障能力和 NoSQL[4]的天然水平伸缩性特点，能够从容应对海量数据。





## 国内外研究现状

Google 早在2006年发表了分布式数据库 BitTable 论文，详细介绍了Bitable 的实际应用和设计原理。Bigtable 设计之初是在千万台普通计算机上可靠的存储海量级别的数据。BigTable 已经实现了可扩展，高性能和高可用性。但是，BitTable 只支持单行事务，对于跨行，跨表的操作，无法提供强一致性的保证。为了解决这个问题，Google在2012 年又发表了 Spanner 论文。Spanner 是全球分布式数据库，通过同步复制和多版本并发控制来支持外部一致性的分布式事务。2013年，Google发布的 F1 在以Spanner 做为数据存储的基础上，支持分布式SQL查询和原子操作，跨数据中心同步和强一致性。Amazon 在2007年发布了分布式K/V数据库 Dynamo，支持高可用和高扩展，采用最终一致性来保证数据的高可用，属于AP。Cassandra 是由Facebook 在2008年开源的分布式键值存储管理系统。另外还有redis cluster ，Hbase等等。

在国内，阿里巴巴在2010 年研发了OceanBase 分布式数据库，支持海量数据存储的高性能分布式数据库，实现了跨行跨表的事务处理。TIDB是PingCAP公司近3年来研发的，其灵感来自于 Google 的 [F1](http://research.google.com/pubs/pub41344.html) 和 Google spanner, 支持包括传统 RDBMS 和 NoSQL 的特性。支持一致性的分布式事务并兼容MySQL协议。







## 本文主要研究内容及结构安排





# 第二章

http://www.infoq.com/cn/articles/cap-twelve-years-later-how-the-rules-have-changed

https://ying-zhang.github.io/cloud/2017/spanner-truetime-cap/

https://zhuanlan.zhihu.com/p/27544985

##CAP理论

CAP理论最早在1998年秋季提出，1999年正式发表。“三选二”的观点在几个方面起了误导作用。首先，由于分区很少发生，那么在系统不存在分区的情况下没什么理由牺牲C或A。其次，C与A之间的取舍可以在同一系统内以非常细小的粒度反复发生，而每一次的决策可能因为具体的操作，乃至因为牵涉到特定的数据或用户而有所不同。最后，这三种性质都可以在程度上衡量，并不是非黑即白的有或无。可用性显然是在0%到100%之间连续变化的，一致性分很多级别，连分区也可以细分为不同含义，如系统内的不同部分对于是否存在分区可以有不一样的认知。

<img src="./images/cap.png" style="zoom:50%" />

## 数据一致性

在分布式数据库中，通过数据副本来保证高可用。如何保证数据和副本之间的数据一致性问题由此而生。数据一致性与系统的可用性等其他性能是相互冲突的，系统需要权衡不同的数据一致性来满足性能需求。因此，衍生出了两种数据一致性模型，用来表示不同程度不同特点的数据一致性。

#### 强一致性和弱一致性

强一致性可以理解为在任意时刻，所有节点中的数据是一样的。同一时间点，在节点A中获取到key1的值与在节点B中获取到key1的值应该都是一样的。

弱一致性包含很多种不同的实现，目前分布式系统中广泛实现的是最终一致性。
所谓最终一致性，就是不保证在任意时刻任意节点上的同一份数据都是相同的，但是随着时间的迁移，不同节点上的同一份数据总是在向趋同的方向变化。也可以简单的理解为在一段时间后，节点间的数据会最终达到一致状态。

## 数据一致性算法

### 2PC

###paxos

### Raft



# 系统需求与分析

## 事务

事务是数据库操作的基本单位，具有原子性，一致性 , 隔离性 和 持久性 这四个基本属性。

SQL定义的4种隔离级别，以下隔离级别依次从低到高：

* Read Uncommitted ：读取未提交的数据，即其他事务已经修改，但还未提交的数据。这是最低的隔离级别。
* Read Committed ： 读取已经提交数据。但是，在一个事务中，可能出现前后两次读取的结果不一样。如第一次读取时另一个事务还未提交，第二次读取时已经提交了。
* Repeatable Read : 可重复读，在一个事务中，对同一项，确保前后两次读取结果是一致的。
* Serializable : 可序列化，即数据库的事务是可串行化执行的，一个事务执行时没有别的事务在执行。是最高的隔离级别。

由于隔离级别的降低可能会引发的问题：

* Dirty Read : 一个事务读取了另外一个事务更新却没有提交的数据。
* 不可重复读
* Phantom Read ：

## 并发控制



